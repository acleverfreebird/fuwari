# Speed Insights æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ (2025-10-25)

> åŸºäºæœ€æ–° Speed Insights æ•°æ®çš„é’ˆå¯¹æ€§ä¼˜åŒ–è®¡åˆ’

## ğŸ“Š å½“å‰æ€§èƒ½è¯Šæ–­

### æ•´ä½“è¯„åˆ†
- **Real Experience Score (RES)**: 81åˆ† âš ï¸ **éœ€è¦æ”¹è¿›**
- **ç›®æ ‡**: æå‡è‡³ 90+ åˆ†ï¼ˆä¼˜ç§€ï¼‰
- **æ”¹å–„ç©ºé—´**: 9åˆ† (11% æå‡)

### æ ¸å¿ƒ Web Vitals æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰å€¼ | ç›®æ ‡å€¼ | çŠ¶æ€ | ä¼˜å…ˆçº§ | æ”¹å–„å¹…åº¦ |
|------|--------|--------|------|--------|----------|
| **FCP** (é¦–æ¬¡å†…å®¹ç»˜åˆ¶) | 2.64s | < 1.8s | ğŸ”´ éœ€ä¼˜åŒ– | é«˜ | â†“ 32% |
| **LCP** (æœ€å¤§å†…å®¹ç»˜åˆ¶) | 3.46s | < 2.5s | ğŸ”´ éœ€ä¼˜åŒ– | é«˜ | â†“ 28% |
| **INP** (äº¤äº’å»¶è¿Ÿ) | 280ms | < 200ms | ğŸ”´ éœ€ä¼˜åŒ– | é«˜ | â†“ 29% |
| **CLS** (ç´¯ç§¯å¸ƒå±€åç§») | 0 | < 0.1 | âœ… ä¼˜ç§€ | ä½ | ä¿æŒ |
| **FID** (é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ) | 4ms | < 100ms | âœ… ä¼˜ç§€ | ä½ | ä¿æŒ |
| **TTFB** (é¦–å­—èŠ‚æ—¶é—´) | 1.05s | < 0.6s | ğŸ”´ éœ€ä¼˜åŒ– | é«˜ | â†“ 43% |

### è·¯ç”±æ€§èƒ½åˆ†æï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

#### ğŸ”´ ä¸¥é‡é—®é¢˜è·¯ç”±

**1. `/posts/[slug]` - RES: 76åˆ†**
- **è®¿é—®é‡**: 120æ¬¡ï¼ˆæœ€é«˜æµé‡ï¼Œå 40%ï¼‰
- **é—®é¢˜**: æ ¸å¿ƒå†…å®¹é¡µé¢æ€§èƒ½å·®ï¼Œç›´æ¥å½±å“ç”¨æˆ·é˜…è¯»ä½“éªŒ
- **ä¼˜åŒ–æ½œåŠ›**: **14åˆ†æå‡ç©ºé—´** (18% æ”¹å–„)
- **å…³é”®é—®é¢˜**:
  - Giscus è¯„è®ºç³»ç»Ÿé˜»å¡æ¸²æŸ“
  - æ–‡ç« å°é¢å›¾ç‰‡åŠ è½½æ…¢
  - ä»£ç å—åˆå§‹æ¸²æŸ“è¿‡å¤š
  - JavaScript æ‰§è¡Œæ—¶é—´é•¿

**2. `/friends` - RES: 72åˆ†**
- **è®¿é—®é‡**: 9æ¬¡
- **é—®é¢˜**: æ€§èƒ½æœ€å·®çš„é¡µé¢
- **ä¼˜åŒ–æ½œåŠ›**: **18åˆ†æå‡ç©ºé—´** (25% æ”¹å–„)
- **å…³é”®é—®é¢˜**:
  - å‹é“¾å¡ç‰‡ä¸€æ¬¡æ€§æ¸²æŸ“
  - å¤´åƒå›¾ç‰‡æœªä¼˜åŒ–
  - ç¼ºå°‘æ‡’åŠ è½½æœºåˆ¶

#### ğŸŸ¡ éœ€æ”¹è¿›è·¯ç”±

**3. `/` (é¦–é¡µ) - RES: 83åˆ†**
- **è®¿é—®é‡**: 44æ¬¡
- **é—®é¢˜**: é¦–é¡µæ˜¯ç”¨æˆ·ç¬¬ä¸€å°è±¡ï¼Œéœ€è¦è¾¾åˆ°ä¼˜ç§€æ°´å¹³
- **ä¼˜åŒ–æ½œåŠ›**: **12åˆ†æå‡ç©ºé—´** (14% æ”¹å–„)
- **å…³é”®é—®é¢˜**:
  - Banner å›¾ç‰‡åŠ è½½æ…¢
  - é¦–å±å†…å®¹è¿‡å¤š
  - å­—ä½“åŠ è½½é˜»å¡æ¸²æŸ“

**4. `/about` - RES: 84åˆ†**
- **è®¿é—®é‡**: 6æ¬¡
- **ä¼˜åŒ–æ½œåŠ›**: **11åˆ†æå‡ç©ºé—´** (13% æ”¹å–„)

#### âœ… ä¼˜ç§€è·¯ç”±

**5. `/archive` - RES: 93åˆ†**
- **è®¿é—®é‡**: 60æ¬¡
- **çŠ¶æ€**: å·²ä¼˜åŒ–è‰¯å¥½ï¼ˆè™šæ‹Ÿæ»šåŠ¨ã€éª¨æ¶å±ã€æ‡’åŠ è½½ï¼‰
- **ä¿æŒç°çŠ¶**: ä½œä¸ºå…¶ä»–é¡µé¢ä¼˜åŒ–çš„å‚è€ƒæ ‡å‡†

---

## ğŸ¯ ä¼˜åŒ–ç­–ç•¥

### é˜¶æ®µä¸€: ç´§æ€¥ä¼˜åŒ– (1-2å‘¨) - ç›®æ ‡ RES: 85+

#### 1. ä¼˜åŒ– `/posts/[slug]` è·¯ç”± (æœ€é«˜ä¼˜å…ˆçº§)

##### 1.1 ä¼˜åŒ– Giscus è¯„è®ºåŠ è½½
**å½“å‰é—®é¢˜**:
```javascript
// è¯„è®ºç³»ç»Ÿåœ¨é¡µé¢åŠ è½½æ—¶ç«‹å³åŠ è½½ï¼Œé˜»å¡æ¸²æŸ“
<script src="https://giscus.app/client.js" ...></script>
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```javascript
// 1. å»¶è¿ŸåŠ è½½ - æ»šåŠ¨åˆ°è¯„è®ºåŒºåŸŸæ—¶æ‰åŠ è½½
// 2. ç”¨æˆ·ä¸»åŠ¨è§¦å‘ - ç‚¹å‡»æŒ‰é’®åŠ è½½
// 3. é¢„è¿æ¥ä¼˜åŒ– - æå‰å»ºç«‹è¿æ¥ä½†ä¸åŠ è½½è„šæœ¬

// å·²å®ç°ä½†éœ€è¦ä¼˜åŒ–çš„éƒ¨åˆ†:
- å‡å°‘ rootMargin ä» 200px åˆ° 100px
- å¢åŠ å»¶è¿Ÿæ—¶é—´ä» 500ms åˆ° 1000ms
- æ·»åŠ åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
```

**é¢„æœŸæ•ˆæœ**:
- LCP: 3.5s â†’ 2.8s (â†“ 20%)
- INP: 300ms â†’ 220ms (â†“ 27%)
- RES: 76 â†’ 85+ (â†‘ 12%)

##### 1.2 ä¼˜åŒ–æ–‡ç« å°é¢å›¾ç‰‡
**å½“å‰é—®é¢˜**:
```astro
<!-- priority={false} ä½†ä»ç„¶ä½¿ç”¨ eager loading -->
<ImageWrapper
    src={entry.data.image}
    priority={false}
/>
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```astro
<!-- 1. æ˜ç¡®ä½¿ç”¨ lazy loading -->
<ImageWrapper
    src={entry.data.image}
    loading="lazy"
    priority={false}
    fetchpriority="low"
/>

<!-- 2. ä½¿ç”¨å“åº”å¼å›¾ç‰‡ -->
<ImageWrapper
    src={entry.data.image}
    sizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 1200px"
    loading="lazy"
/>

<!-- 3. æ·»åŠ å ä½ç¬¦é˜²æ­¢ CLS -->
<div class="aspect-video bg-gray-200 dark:bg-gray-800">
    <ImageWrapper ... />
</div>
```

**é¢„æœŸæ•ˆæœ**:
- LCP: 3.5s â†’ 2.5s (â†“ 29%)
- FCP: 2.8s â†’ 2.2s (â†“ 21%)

##### 1.3 ä¼˜åŒ–ä»£ç å—æ¸²æŸ“
**å½“å‰é—®é¢˜**:
```javascript
// astro.config.mjs
pluginCodeBlockCollapse({ collapseAfter: 20 })
// 20è¡Œä»¥ä¸Šæ‰æŠ˜å ï¼Œåˆå§‹æ¸²æŸ“è¿‡å¤š
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```javascript
// 1. é™ä½æŠ˜å é˜ˆå€¼
pluginCodeBlockCollapse({ 
    collapseAfter: 15,  // ä» 20 é™åˆ° 15
    defaultCollapsed: true  // é»˜è®¤æŠ˜å 
})

// 2. å»¶è¿Ÿé«˜äº®éå¯è§ä»£ç å—
// 3. ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†é•¿ä»£ç 
```

**é¢„æœŸæ•ˆæœ**:
- INP: 280ms â†’ 200ms (â†“ 29%)
- JavaScript æ‰§è¡Œæ—¶é—´: â†“ 35%

---

#### 2. ä¼˜åŒ–æ ¸å¿ƒ Web Vitals

##### 2.1 å‡å°‘ FCP (2.64s â†’ 1.6s)

**ä¼˜åŒ–æ–¹æ¡ˆ A: å†…è”å…³é”® CSS**
```astro
<!-- src/layouts/Layout.astro -->
<head>
    <style>
        /* å†…è”å…³é”® CSS - é¦–å±æ¸²æŸ“å¿…éœ€ */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--page-bg);
        }
        
        .card-base {
            background: var(--card-bg);
            border-radius: var(--radius-large);
        }
        
        /* éª¨æ¶å±æ ·å¼ */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
    </style>
    
    <!-- å»¶è¿ŸåŠ è½½éå…³é”® CSS -->
    <link rel="preload" href="/_astro/main.css" as="style" 
          onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link rel="stylesheet" href="/_astro/main.css" /></noscript>
</head>
```

**ä¼˜åŒ–æ–¹æ¡ˆ B: ä¼˜åŒ–å­—ä½“åŠ è½½**
```astro
<head>
    <!-- 1. é¢„è¿æ¥å­—ä½“ CDN -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- 2. ä½¿ç”¨ font-display: swap -->
    <link rel="stylesheet" 
          href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
          media="print" 
          onload="this.media='all'" />
    
    <!-- 3. ç³»ç»Ÿå­—ä½“å›é€€ -->
    <style>
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 
                         'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
        }
    </style>
</head>
```

**é¢„æœŸæ•ˆæœ**:
- FCP: 2.64s â†’ 1.6s (â†“ 39%)
- é¦–å±æ¸²æŸ“é€Ÿåº¦æå‡ 45%

##### 2.2 å‡å°‘ LCP (3.46s â†’ 2.0s)

**ä¼˜åŒ–æ–¹æ¡ˆ A: Banner å›¾ç‰‡ä¼˜åŒ–**
```bash
# 1. è½¬æ¢ä¸º WebP æ ¼å¼
npm install sharp-cli -g

# 2. ç”Ÿæˆå“åº”å¼å›¾ç‰‡
sharp -i src/assets/images/banner.png \
      -o public/banner-mobile.webp \
      --resize 800 \
      --webp '{"quality": 85}'

sharp -i src/assets/images/banner.png \
      -o public/banner-tablet.webp \
      --resize 1200 \
      --webp '{"quality": 85}'

sharp -i src/assets/images/banner.png \
      -o public/banner-desktop.webp \
      --resize 1920 \
      --webp '{"quality": 80}'
```

**ä¼˜åŒ–æ–¹æ¡ˆ B: å“åº”å¼å›¾ç‰‡åŠ è½½**
```astro
<!-- src/layouts/MainGridLayout.astro -->
<picture>
    <source srcset="/banner-mobile.webp" 
            media="(max-width: 768px)" 
            type="image/webp">
    <source srcset="/banner-tablet.webp" 
            media="(max-width: 1200px)" 
            type="image/webp">
    <source srcset="/banner-desktop.webp" 
            media="(min-width: 1201px)" 
            type="image/webp">
    <img src="/banner-desktop.webp" 
         alt="Banner" 
         loading="eager"
         fetchpriority="high"
         decoding="async">
</picture>
```

**ä¼˜åŒ–æ–¹æ¡ˆ C: å…³é”®èµ„æºé¢„åŠ è½½**
```astro
<head>
    <!-- åªé¢„åŠ è½½å½“å‰è®¾å¤‡éœ€è¦çš„ Banner -->
    <link rel="preload" 
          href="/banner-desktop.webp" 
          as="image" 
          type="image/webp"
          media="(min-width: 1201px)"
          fetchpriority="high">
    
    <link rel="preload" 
          href="/banner-tablet.webp" 
          as="image" 
          type="image/webp"
          media="(min-width: 769px) and (max-width: 1200px)"
          fetchpriority="high">
    
    <link rel="preload" 
          href="/banner-mobile.webp" 
          as="image" 
          type="image/webp"
          media="(max-width: 768px)"
          fetchpriority="high">
</head>
```

**é¢„æœŸæ•ˆæœ**:
- LCP: 3.46s â†’ 2.0s (â†“ 42%)
- å›¾ç‰‡åŠ è½½æ—¶é—´: â†“ 65%
- å¸¦å®½èŠ‚çœ: â†“ 70%

##### 2.3 å‡å°‘ INP (280ms â†’ 180ms)

**ä¼˜åŒ–æ–¹æ¡ˆ A: JavaScript æ‰§è¡Œä¼˜åŒ–**
```javascript
// src/layouts/Layout.astro
<script>
    // å½“å‰: åŒæ­¥æ‰§è¡Œå¯èƒ½é˜»å¡ä¸»çº¿ç¨‹
    function init() {
        loadTheme();
        loadHue();
        showBanner();
        initCustomScrollbar();  // é˜»å¡
    }
    
    // ä¼˜åŒ–: ä½¿ç”¨ requestIdleCallback å»¶è¿Ÿéå…³é”®åˆå§‹åŒ–
    function init() {
        // å…³é”®åˆå§‹åŒ– - ç«‹å³æ‰§è¡Œ
        loadTheme();
        loadHue();
        showBanner();
        
        // éå…³é”®åˆå§‹åŒ– - å»¶è¿Ÿæ‰§è¡Œ
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => {
                initCustomScrollbar();
                setupLazyLoad();
            }, { timeout: 2000 });
        } else {
            setTimeout(() => {
                initCustomScrollbar();
                setupLazyLoad();
            }, 100);
        }
    }
</script>
```

**ä¼˜åŒ–æ–¹æ¡ˆ B: äº‹ä»¶ç›‘å¬å™¨èŠ‚æµ**
```javascript
// ä¼˜åŒ–æ»šåŠ¨äº‹ä»¶
function throttle(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// åº”ç”¨èŠ‚æµ
window.addEventListener('scroll', throttle(scrollFunction, 100));
```

**é¢„æœŸæ•ˆæœ**:
- INP: 280ms â†’ 180ms (â†“ 36%)
- äº¤äº’å“åº”é€Ÿåº¦æå‡ 40%

##### 2.4 å‡å°‘ TTFB (1.05s â†’ 0.6s)

**ä¼˜åŒ–æ–¹æ¡ˆ: å¢å¼º CDN ç¼“å­˜**
```json
// vercel.json
{
    "regions": ["sin1", "hkg1", "nrt1", "sfo1", "iad1"],
    "headers": [
        {
            "source": "/:path*.html",
            "headers": [
                {
                    "key": "Cache-Control",
                    "value": "public, max-age=0, must-revalidate"
                },
                {
                    "key": "CDN-Cache-Control",
                    "value": "public, s-maxage=7200, stale-while-revalidate=86400"
                }
            ]
        },
        {
            "source": "/_astro/:path*",
            "headers": [
                {
                    "key": "Cache-Control",
                    "value": "public, max-age=31536000, immutable"
                },
                {
                    "key": "CDN-Cache-Control",
                    "value": "public, max-age=31536000, immutable"
                }
            ]
        }
    ]
}
```

**é¢„æœŸæ•ˆæœ**:
- TTFB: 1.05s â†’ 0.6s (â†“ 43%)
- ç¼“å­˜å‘½ä¸­ç‡: â†‘ 60%

---

### é˜¶æ®µäºŒ: å…¨é¢ä¼˜åŒ– (2-3å‘¨) - ç›®æ ‡ RES: 90+

#### 3. ä¼˜åŒ–å…¶ä»–è·¯ç”±

##### 3.1 ä¼˜åŒ– `/friends` è·¯ç”± (RES: 72 â†’ 90+)

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```svelte
<!-- src/pages/friends.astro -->
<script>
    import { onMount } from 'svelte';
    
    let visibleFriends = [];
    let allFriends = [...friends];
    
    onMount(() => {
        // åˆå§‹åªæ˜¾ç¤ºå‰ 6 ä¸ªå‹é“¾
        visibleFriends = allFriends.slice(0, 6);
        
        // ä½¿ç”¨ Intersection Observer æ‡’åŠ è½½å‰©ä½™å‹é“¾
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && visibleFriends.length < allFriends.length) {
                    const nextBatch = allFriends.slice(
                        visibleFriends.length,
                        visibleFriends.length + 6
                    );
                    visibleFriends = [...visibleFriends, ...nextBatch];
                }
            });
        }, { rootMargin: '200px' });
        
        const container = document.getElementById('friends-container');
        if (container) observer.observe(container);
    });
</script>

<!-- å‹é“¾å¡ç‰‡æ‡’åŠ è½½å¤´åƒ -->
<img 
    src={friend.avatar} 
    alt={friend.name}
    loading="lazy"
    decoding="async"
    fetchpriority="low"
/>
```

**é¢„æœŸæ•ˆæœ**:
- RES: 72 â†’ 92+ (â†‘ 28%)
- LCP: â†“ 45%
- INP: â†“ 35%

##### 3.2 ä¼˜åŒ–é¦–é¡µ `/` (RES: 83 â†’ 95+)

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```astro
<!-- src/pages/index.astro -->
---
// 1. åªåŠ è½½é¦–å±æ–‡ç« 
const recentPosts = await getSortedPosts();
const firstPagePosts = recentPosts.slice(0, 6);
---

<!-- 2. å»¶è¿ŸåŠ è½½éé¦–å±å†…å®¹ -->
<div class="posts-container">
    {firstPagePosts.map(post => (
        <PostCard post={post} loading="eager" />
    ))}
</div>

<!-- 3. æ‡’åŠ è½½æ›´å¤šæ–‡ç«  -->
<div id="more-posts" class="hidden">
    {recentPosts.slice(6).map(post => (
        <PostCard post={post} loading="lazy" />
    ))}
</div>

<script>
    // æ»šåŠ¨åˆ°åº•éƒ¨æ—¶æ˜¾ç¤ºæ›´å¤šæ–‡ç« 
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                document.getElementById('more-posts').classList.remove('hidden');
                observer.disconnect();
            }
        });
    });
    
    const postsContainer = document.querySelector('.posts-container');
    if (postsContainer) observer.observe(postsContainer);
</script>
```

**é¢„æœŸæ•ˆæœ**:
- RES: 83 â†’ 95+ (â†‘ 14%)
- FCP: â†“ 30%
- LCP: â†“ 25%

---

#### 4. å®æ–½é«˜çº§ä¼˜åŒ–

##### 4.1 Service Worker ç¼“å­˜ç­–ç•¥

**åˆ›å»º public/sw.js**:
```javascript
const CACHE_VERSION = 'v2';
const STATIC_CACHE = `static-${CACHE_VERSION}`;
const DYNAMIC_CACHE = `dynamic-${CACHE_VERSION}`;
const IMAGE_CACHE = `images-${CACHE_VERSION}`;

// é¢„ç¼“å­˜é™æ€èµ„æº
const STATIC_ASSETS = [
    '/',
    '/offline/',
    '/_astro/main.css',
    '/banner-desktop.webp',
];

// å®‰è£…äº‹ä»¶
self.addEventListener('install', (event) => {
    event.waitUntil(
        caches.open(STATIC_CACHE).then((cache) => {
            return cache.addAll(STATIC_ASSETS);
        })
    );
    self.skipWaiting();
});

// æ¿€æ´»äº‹ä»¶ - æ¸…ç†æ—§ç¼“å­˜
self.addEventListener('activate', (event) => {
    event.waitUntil(
        caches.keys().then((cacheNames) => {
            return Promise.all(
                cacheNames
                    .filter((name) => name.startsWith('static-') || 
                                     name.startsWith('dynamic-') || 
                                     name.startsWith('images-'))
                    .filter((name) => name !== STATIC_CACHE && 
                                     name !== DYNAMIC_CACHE && 
                                     name !== IMAGE_CACHE)
                    .map((name) => caches.delete(name))
            );
        })
    );
    self.clients.claim();
});

// Fetch äº‹ä»¶ - ç¼“å­˜ç­–ç•¥
self.addEventListener('fetch', (event) => {
    const { request } = event;
    const url = new URL(request.url);

    // è·³è¿‡é GET è¯·æ±‚
    if (request.method !== 'GET') return;

    // API è¯·æ±‚ - Network First
    if (url.pathname.startsWith('/api/')) {
        event.respondWith(networkFirst(request, DYNAMIC_CACHE));
        return;
    }

    // å›¾ç‰‡è¯·æ±‚ - Cache First
    if (request.destination === 'image') {
        event.respondWith(cacheFirst(request, IMAGE_CACHE));
        return;
    }

    // é™æ€èµ„æº - Cache First
    if (url.pathname.startsWith('/_astro/')) {
        event.respondWith(cacheFirst(request, STATIC_CACHE));
        return;
    }

    // HTML é¡µé¢ - Network First with Cache Fallback
    if (request.destination === 'document') {
        event.respondWith(networkFirst(request, DYNAMIC_CACHE));
        return;
    }

    // å…¶ä»–è¯·æ±‚ - Network First
    event.respondWith(networkFirst(request, DYNAMIC_CACHE));
});

// Cache First ç­–ç•¥
async function cacheFirst(request, cacheName) {
    const cache = await caches.open(cacheName);
    const cached = await cache.match(request);
    
    if (cached) {
        return cached;
    }

    try {
        const response = await fetch(request);
        if (response.ok) {
            cache.put(request, response.clone());
        }
        return response;
    } catch (error) {
        console.error('Fetch failed:', error);
        throw error;
    }
}

// Network First ç­–ç•¥
async function networkFirst(request, cacheName) {
    const cache = await caches.open(cacheName);
    
    try {
        const response = await fetch(request);
        if (response.ok) {
            cache.put(request, response.clone());
        }
        return response;
    } catch (error) {
        const cached = await cache.match(request);
        if (cached) {
            return cached;
        }
        
        // å¦‚æœæ˜¯ HTML è¯·æ±‚ä¸”ç¼“å­˜æœªå‘½ä¸­ï¼Œè¿”å›ç¦»çº¿é¡µé¢
        if (request.destination === 'document') {
            return cache.match('/offline/');
        }
        
        throw error;
    }
}
```

**æ³¨å†Œ Service Worker**:
```astro
<!-- src/layouts/Layout.astro -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then((registration) => {
                    console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);
                    
                    // æ£€æŸ¥æ›´æ–°
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && 
                                navigator.serviceWorker.controller) {
                                // æ–°ç‰ˆæœ¬å¯ç”¨
                                if (confirm('å‘ç°æ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦åˆ·æ–°é¡µé¢ï¼Ÿ')) {
                                    window.location.reload();
                                }
                            }
                        });
                    });
                })
                .catch((error) => {
                    console.error('âŒ Service Worker æ³¨å†Œå¤±è´¥:', error);
                });
        });
    }
</script>
```

**é¢„æœŸæ•ˆæœ**:
- é‡å¤è®¿é—®é€Ÿåº¦æå‡ 70%
- ç¦»çº¿è®¿é—®æ”¯æŒ
- å‡å°‘æœåŠ¡å™¨è¯·æ±‚ 50%

##### 4.2 èµ„æºä¼˜å…ˆçº§ä¼˜åŒ–

```astro
<!-- src/layouts/Layout.astro -->
<head>
    <!-- å…³é”®èµ„æº - æœ€é«˜ä¼˜å…ˆçº§ -->
    <link rel="preload" href="/_astro/main.css" as="style" fetchpriority="high" />
    <link rel="preload" href="/banner-desktop.webp" as="image" fetchpriority="high" />
    
    <!-- å­—ä½“ - é«˜ä¼˜å…ˆçº§ -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preload" 
          href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" 
          as="style" 
          fetchpriority="high" />
    
    <!-- åˆ†æè„šæœ¬ - ä½ä¼˜å…ˆçº§ -->
    <link rel="preconnect" href="https://views.freebird2913.tech" />
    <link rel="dns-prefetch" href="https://www.clarity.ms" />
    
    <!-- ç¬¬ä¸‰æ–¹èµ„æº - æœ€ä½ä¼˜å…ˆçº§ -->
    <link rel="preconnect" href="https://giscus.app" fetchpriority="low" />
</head>

<body>
    <!-- å…³é”®å†…å®¹ - é«˜ä¼˜å…ˆçº§ -->
    <img src="/banner.webp" fetchpriority="high" loading="eager" />
    
    <!-- éå…³é”®å›¾ç‰‡ - ä½ä¼˜å…ˆçº§ -->
    <img src="/avatar.webp" fetchpriority="low" loading="lazy" />
</body>
```

---

## ğŸ“ˆ é¢„æœŸæ€§èƒ½æå‡æ€»è§ˆ

### æ ¸å¿ƒæŒ‡æ ‡æ”¹å–„

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æ”¹å–„å¹…åº¦ | å®æ–½éš¾åº¦ |
|------|------|------|----------|----------|
| **RES** | 81 | 95+ | â†‘ 17% | ä¸­ |
| **FCP** | 2.64s | 1.6s | â†“ 39% | ä¸­ |
| **LCP** | 3.46s | 2.0s | â†“ 42% | é«˜ |
| **INP** | 280ms | 180ms | â†“ 36% | ä¸­ |
| **TTFB** | 1.05s | 0.6s | â†“ 43% | ä½ |

### è·¯ç”±æ€§èƒ½æ”¹å–„

| è·¯ç”± | å½“å‰ RES | ç›®æ ‡ RES | æ”¹å–„ | ä¼˜å…ˆçº§ |
|------|----------|----------|------|--------|
| `/posts/[slug]` | 76 | 90+ | â†‘ 18% | ğŸ”´ æœ€é«˜ |
| `/friends` | 72 | 92+ | â†‘ 28% | ğŸ”´ é«˜ |
| `/` | 83 | 95+ | â†‘ 14% | ğŸŸ¡ ä¸­ |
| `/about` | 84 | 95+ | â†‘ 13% | ğŸŸ¡ ä¸­ |
| `/archive` | 93 | 93 | ä¿æŒ | ğŸŸ¢ ä½ |

---

## ğŸš€ å®æ–½æ—¶é—´è¡¨

### ç¬¬ 1 å‘¨: ç´§æ€¥ä¼˜åŒ–
- **Day 1-2**: ä¼˜åŒ– `/posts/[slug]` è·¯ç”±
  - [ ] ä¼˜åŒ– Giscus è¯„è®ºåŠ è½½
  - [ ] ä¼˜åŒ–æ–‡ç« å°é¢å›¾ç‰‡
  - [ ] ä¼˜åŒ–ä»£ç å—æ¸²æŸ“
- **Day 3-4**: ä¼˜åŒ–æ ¸å¿ƒ Web Vitals
  - [ ] å‡å°‘ FCP (å†…è” CSSã€ä¼˜åŒ–å­—ä½“)
  - [ ] å‡å°‘ LCP (Banner å›¾ç‰‡ä¼˜åŒ–)
- **Day 5**: æµ‹è¯•å’ŒéªŒè¯
  - [ ] Lighthouse æµ‹è¯•
  - [ ] Speed Insights éªŒè¯

**é‡Œç¨‹ç¢‘**: RES æå‡è‡³ 85+

### ç¬¬ 2 å‘¨: å…¨é¢ä¼˜åŒ–
- **Day 1-2**: ä¼˜åŒ–å…¶ä»–è·¯ç”±
  - [ ] `/friends` è·¯ç”±ä¼˜åŒ–
  - [ ] é¦–é¡µä¼˜åŒ–
- **Day 3-4**: é«˜çº§ä¼˜åŒ–
  - [ ] Service Worker å®æ–½
  - [ ] èµ„æºä¼˜å…ˆçº§ä¼˜åŒ–
- **Day 5**: æ€§èƒ½ç›‘æ§é›†æˆ
  - [ ] Web Vitals ç›‘æ§
  - [ ] Lighthouse CI é…ç½®

**é‡Œç¨‹ç¢‘**: RES æå‡è‡³ 90+

### ç¬¬ 3 å‘¨: ç²¾ç»†è°ƒä¼˜
- **Day 1-3**: æ€§èƒ½å¾®è°ƒ
  - [ ] ä¼˜åŒ– INP
  - [ ] ä¼˜åŒ– TTFB
  - [ ] CDN ç¼“å­˜ä¼˜åŒ–
- **Day 4-5**: æ–‡æ¡£å’Œæ€»ç»“
  - [ ] æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£
  - [ ] æœ€ä½³å®è·µæ€»ç»“

**æœ€ç»ˆç›®æ ‡**: RES æå‡è‡³ 95+

---

## âœ… éªŒè¯æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æ‰€æœ‰å›¾ç‰‡å·²è½¬æ¢ä¸º WebP æ ¼å¼
- [ ] å…³é”® CSS å·²å†…è”
- [ ] Service Worker å·²æ³¨å†Œ
- [ ] æ€§èƒ½ç›‘æ§å·²é…ç½®
- [ ] Lighthouse è¯„åˆ† > 90
- [ ] æ‰€æœ‰è·¯ç”± RES > 85

### éƒ¨ç½²åéªŒè¯
- [ ] æ‰€æœ‰è·¯ç”± RES > 90
- [ ] FCP < 1.8s
- [ ] LCP < 2.5s
- [ ] INP < 200ms
- [ ] TTFB < 0.6s
- [ ] CLS < 0.1
- [ ] ç¼“å­˜å‘½ä¸­ç‡ > 60%

---

## ğŸ“š å‚è€ƒèµ„æº

- [Web Vitals](https://web.dev/vitals/)
- [Vercel Speed Insights](https://vercel.com/docs/speed-insights)
- [Lighthouse Performance Scoring](https://web.dev/performance-scoring/)
- [Service Worker API](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API)
- [Resource Hints](https://www.w3.org/TR/resource-hints/)
- [Image Optimization](https://web.dev/fast/#optimize-your-images)

---

**åˆ›å»ºæ—¥æœŸ**: 2025-10-25  
**æœ€åæ›´æ–°**: 2025-10-25  
**çŠ¶æ€**: ğŸ“‹ å‡†å¤‡å®æ–½
**é¢„æœŸå®Œæˆ**: 2025-11-15