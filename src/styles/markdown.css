.custom-md {
    h1 {
        @apply text-3xl;
    }

    h1, h2, h3, h4, h5, h6 {
        .anchor {
            @apply transition -m-0.5 ml-[0.2ch] p-0.5 select-none opacity-0 no-underline !important;

            .anchor-icon {
                @apply mx-[0.45ch] !important;
            }
        }

        &:hover {
            .anchor {
                @apply opacity-100 !important;
            }
        }
    }

    a:not(.no-styling) {
        @apply relative bg-none font-medium text-[var(--primary)]
        underline decoration-[var(--link-underline)] decoration-1 decoration-dashed underline-offset-4;
        @apply transition rounded-md p-1 -m-1 relative before:ease-out before:transition active:bg-none hover:before:bg-[var(--btn-plain-bg-hover)] active:before:bg-[var(--btn-plain-bg-active)] z-0 before:absolute before:rounded-[inherit] before:inset-0 before:scale-[0.85] hover:before:scale-100 before:-z-10; /* Copied from .link in main.css */
        box-decoration-break: clone;
        -webkit-box-decoration-break: clone;
    
        &:hover, &:active {
            @apply decoration-transparent;
            background: var(--btn-plain-bg-hover);
            border-bottom: 1px dashed var(--link-hover);
            text-decoration: none;
        }
    }

    code {
        @apply bg-[var(--inline-code-bg)] text-[var(--inline-code-color)] px-1 py-0.5 rounded-md overflow-hidden;

        font-family: 'JetBrains Mono Variable', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace;
        &:before {
            content:none;
        }
        &:after {
            content:none;
        }

        counter-reset: line;
        span.line {
            &:before {
                @apply text-white/25 mr-4 w-4 inline-block;
                content: counter(line);
                counter-increment: line;
                direction: rtl;
            }
            &:last-child:empty, &:last-child:has(> span:empty:only-child) {
                display: none;
            }
        }
    }

    /* 复制按钮样式（保持原有） */
    .copy-btn {
        all: initial;
        @apply opacity-0 shadow-lg shadow-black/50 absolute active:scale-90 h-8 w-8 top-3 right-3 text-sm rounded-lg transition-all ease-in-out z-20 cursor-pointer;
        @apply flex items-center justify-center
        bg-[oklch(0.45_0.01_var(--hue))] hover:bg-[oklch(0.50_0.01_var(--hue))] active:bg-[oklch(0.55_0.01_var(--hue))]
        dark:bg-[oklch(0.30_0.02_var(--hue))] dark:hover:bg-[oklch(0.35_0.03_var(--hue))] dark:active:bg-[oklch(0.40_0.03_var(--hue))];
    }
    .frame:hover .copy-btn {
        opacity: 1;
    }

    .copy-btn-icon {
        @apply absolute top-1/2 left-1/2 transition -translate-x-1/2 -translate-y-1/2 w-4 h-4 fill-white pointer-events-none;
    }
    .copy-btn .copy-icon {
        @apply opacity-100 fill-white dark:fill-white/75;
    }
    .copy-btn.success .copy-icon {
        @apply opacity-0 fill-[var(--deep-text)]
    }
    .copy-btn .success-icon {
        @apply opacity-0 fill-white;
    }
    .copy-btn.success .success-icon {
        @apply opacity-100
    }

    /* ========== 代码块折叠功能样式 ========== */
    
    /* 可折叠的pre元素 - 直接应用到.expressive-code的pre上 */
    .expressive-code pre.collapsible-pre {
        @apply relative overflow-hidden;
        transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                    margin-bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        border-bottom-left-radius: 0 !important;
        border-bottom-right-radius: 0 !important;
    }

    /* 折叠状态 */
    .expressive-code pre.collapsible-pre[data-collapsed="true"] {
        max-height: 600px; /* 约20行代码 */
        margin-bottom: 0 !important;
    }

    .expressive-code pre.collapsible-pre[data-collapsed="false"] {
        max-height: 5000px; /* 足够大的值以容纳展开的内容 */
        margin-bottom: 0 !important;
    }

    /* 渐变蒙层 - 在pre内部 */
    .code-fade-overlay {
        @apply absolute left-0 right-0 pointer-events-none;
        bottom: 0;
        height: 150px;
        background: linear-gradient(
            to bottom,
            transparent 0%,
            rgba(0, 0, 0, 0.3) 50%,
            var(--codeblock-bg) 100%
        );
        opacity: 1;
        transition: opacity 0.4s ease;
        z-index: 10;
    }

    .expressive-code pre.collapsible-pre[data-collapsed="false"] .code-fade-overlay {
        opacity: 0;
        pointer-events: none;
    }

    /* 展开/收起按钮 - 在.expressive-code容器内，pre元素之后 */
    .expressive-code .code-expand-btn {
        @apply w-full py-3 px-4 cursor-pointer;
        @apply flex items-center justify-center gap-2;
        @apply text-sm font-medium;
        background: var(--codeblock-bg);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-top: none;
        border-radius: 0 0 0.75rem 0.75rem;
        color: oklch(0.75 0.1 var(--hue));
        margin-top: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        z-index: 1;
    }

    .expressive-code .code-expand-btn:hover {
        background: oklch(0.35 0.02 var(--hue));
        color: oklch(0.85 0.12 var(--hue));
        transform: translateY(-1px);
    }

    .expressive-code .code-expand-btn:active {
        background: oklch(0.40 0.03 var(--hue));
        transform: translateY(0);
    }

    .expressive-code .code-expand-btn:focus-visible {
        @apply outline-none ring-2 ring-offset-2;
        ring-color: oklch(0.65 0.15 var(--hue));
    }

    /* 展开/收起文本切换 */
    .expressive-code .code-expand-btn .collapse-text {
        @apply hidden;
    }

    .expressive-code .code-expand-btn.expanded .expand-text {
        @apply hidden;
    }

    .expressive-code .code-expand-btn.expanded .collapse-text {
        @apply block;
    }

    /* 添加图标指示器 */
    .expressive-code .code-expand-btn::after {
        content: '';
        @apply inline-block w-4 h-4 ml-2;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
        background-size: contain;
        background-repeat: no-repeat;
    }

    .expressive-code .code-expand-btn.expanded::after {
        transform: rotate(180deg);
    }

    .expressive-code {
        @apply my-4;
        ::selection {
            @apply bg-[var(--codeblock-selection)];
        }

    }


    ul, ol {
        li::marker {
            @apply text-[var(--primary)];
        }
    }

    blockquote {
        @apply not-italic border-transparent relative;
        font-weight: inherit;

        &:before {
            @apply content-[''] absolute -left-1 block transition bg-[var(--btn-regular-bg)] h-full w-1 rounded-full;
        }

        /* Remove the double quotes from default styles */
        p:before, p:after {
            @apply content-none;
        }

    }

    .katex-display-container {
        max-width: 100%;
        overflow-x: auto;
        margin: 1em 0;
    }
    
}
